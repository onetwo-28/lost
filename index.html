<script>
  const girlIdle = document.getElementById("girl-idle");
  const girlIdleLeft = document.getElementById("girl-idle-left");
  const girlWalkLeft = document.getElementById("girl-walk-left");
  const girlTurnLeft = document.getElementById("girl-turn-left");
  const girlTurn = document.getElementById("girl-turn");
  const girlWalk = document.getElementById("girl-walk");
  let girlX = -50;

  function showGIF(state) {
    girlIdle.style.display = state === "idle" ? "block" : "none";
    girlIdleLeft.style.display = state === "idle-left" ? "block" : "none";
    girlTurn.style.display = state === "turn" ? "block" : "none";
    girlTurnLeft.style.display = state === "turn-left" ? "block" : "none";
    girlWalk.style.display = state === "walk-right" ? "block" : "none";
    girlWalkLeft.style.display = state === "walk-left" ? "block" : "none";
  }

  function moveGirlTo(targetX, onArrival) {
    const direction = girlX < targetX ? 'right' : 'left';
    showGIF(direction === 'right' ? "turn" : "turn-left");

    setTimeout(() => {
      showGIF(direction === 'right' ? "walk-right" : "walk-left");
      const interval = setInterval(() => {
        if ((direction === 'right' && girlX < targetX) || (direction === 'left' && girlX > targetX)) {
          girlX += direction === 'right' ? 5 : -5;
          const newX = girlX + "px";
          girlIdle.style.left = girlIdleLeft.style.left = girlTurn.style.left =
          girlTurnLeft.style.left = girlWalk.style.left = girlWalkLeft.style.left = newX;
        } else {
          clearInterval(interval);
          setTimeout(() => {
            showGIF(direction === 'right' ? "idle" : "idle-left");
          }, 500);
          if (onArrival) onArrival();
        }
      }, 20);
    }, 1000);
  }

  function handleInteraction(staticId, animId, targetX) {
    moveGirlTo(targetX - 50, () => {
      const staticEl = document.getElementById(staticId);
      const animEl = document.getElementById(animId);
      staticEl.style.display = "none";
      animEl.style.display = "block";
      setTimeout(() => {
        animEl.style.display = "none";
        staticEl.style.display = "block";
      }, 10000);
    });
  }

  // 회전목마, 대관람차, 연주자
  document.getElementById("carousel-static").addEventListener("click", () => {
    handleInteraction("carousel-static", "carousel-anim", 300);
  });

  document.getElementById("ferris-static").addEventListener("click", () => {
    handleInteraction("ferris-static", "ferris-anim", 1200);
  });

  document.getElementById("musicians-static").addEventListener("click", () => {
    handleInteraction("musicians-static", "musicians-anim", 2100);
  });

  // 문 1~3: 클릭하면 사라졌다가 5초 뒤에 복귀
  ["door1", "door2", "door3"].forEach(id => {
    const door = document.getElementById(id);
    door.addEventListener("click", () => {
      door.style.display = "none";
      setTimeout(() => {
        door.style.display = "block";
      }, 5000);
    });
  });

  // 문 4: 토글 열림/닫힘
  document.getElementById("door4").addEventListener("click", () => {
    const door = document.getElementById("door4");
    door.style.display = door.style.display === "none" ? "block" : "none";
  });

  // 여자아이 클릭 이동
  document.getElementById("scene-container").addEventListener("click", (e) => {
    if (e.target.id === "scene-container") {
      const targetX = e.clientX + window.scrollX - 100;
      moveGirlTo(targetX);
    }
  });

  // 시작 시 기본 자세로 설정
  window.addEventListener("load", () => {
    showGIF("idle");
  });
</script>
